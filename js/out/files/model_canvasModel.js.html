<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>model\canvasModel.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/fan1xia.Failed.html">fan1xia.Failed</a></li>
            
                <li><a href="../classes/fan1xia.Failed.prototype.html">fan1xia.Failed.prototype</a></li>
            
                <li><a href="../classes/fan1xia.Index.html">fan1xia.Index</a></li>
            
                <li><a href="../classes/fan1xia.Index.prototype.html">fan1xia.Index.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.Canvas.html">fan1xia.model.Canvas</a></li>
            
                <li><a href="../classes/fan1xia.model.Canvas.prototype.html">fan1xia.model.Canvas.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.Images.html">fan1xia.model.Images</a></li>
            
                <li><a href="../classes/fan1xia.model.Images.prototype.html">fan1xia.model.Images.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.Score.html">fan1xia.model.Score</a></li>
            
                <li><a href="../classes/fan1xia.model.Score.prototype.html">fan1xia.model.Score.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.StorageModel.html">fan1xia.model.StorageModel</a></li>
            
                <li><a href="../classes/fan1xia.model.StorageModel.prototype.html">fan1xia.model.StorageModel.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.Store.html">fan1xia.model.Store</a></li>
            
                <li><a href="../classes/fan1xia.model.Store.prototype.html">fan1xia.model.Store.prototype</a></li>
            
                <li><a href="../classes/fan1xia.model.Timer.html">fan1xia.model.Timer</a></li>
            
                <li><a href="../classes/fan1xia.model.Timer.prototype.html">fan1xia.model.Timer.prototype</a></li>
            
                <li><a href="../classes/fan1xia.Success.html">fan1xia.Success</a></li>
            
                <li><a href="../classes/fan1xia.Success.prototype.html">fan1xia.Success.prototype</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/canvasModel.html">canvasModel</a></li>
            
                <li><a href="../modules/imagesModel.html">imagesModel</a></li>
            
                <li><a href="../modules/index.html">index</a></li>
            
                <li><a href="../modules/storageModel.html">storageModel</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: model\canvasModel.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/** 
* 画布对象
*
* @module canvasModel
* @namespace fan1xia.model
* @main canvasModel
* @author 颜海镜
* @version 2012-09-29 15:20:04
*/
(function($, window){
	&#x27;use strict&#x27;;
	var Canvas,
		Timer,
		Store,
		Score;
	/**
	* 画布类
	* @class Canvas
	* @constructor
	* @extends fan1xia.model.Canvas.prototype
	*/
	Canvas = function(){
	    /**
	     * 时间对象
	     * @property timer
	     * @type Object
	     * @default null
	     */
		this.timer = null;
		
		/**
         * 分数对象
         * @property score
         * @type Object
         * @default null
         */
		this.score = null;
		
		/**
         * 存数对象
         * @property store
         * @type Object
         * @default null
         */
		this.store = null;
		
		/**
         * 图片对象
         * @property images
         * @type Object
         * @default null
         */
		this.images = null;
		
		/**
         * 声音对象
         * @property sound
         * @type Object
         * @default null
         */
		this.sound = new window.yan.Sound();
	};
	
	/**
	* Canvas构造函数的原型对象
	* @class Canvas.prototype
	* @static
	*/
	Canvas.prototype = {
		/**
		 * 初始化
		 * @method init 
		 */
		init:function(level, grad){
		    var
		        score = new Score(),
                timer = new Timer(),
                store = new Store();
                
            this.score = score;
            this.timer = timer;
            this.store = store;
			this.bindClickEvent();		
			this.images = new window.fan1xia.model.Images();
			this.images.init();	
		},
		
		/**
		 * 刷新画布元素
		 * @method refresh 
		 * @param {Number} level游戏的级别
		 * @param {Number} grad 游戏单个图象重复的次数
		 */
		refresh:function(level, grad){
			var images = this.images,
			imgDoms = [],
			$table = $(&#x27;#canvas table&#x27;),
			score = this.score,
			timer = this.timer,
			store = this.store;

			//收起 散开
			$table.yanVhSlideCenter(0, function(){
				$table.yanVhSlideSide(&#x27;slow&#x27;);
			});
			
			//清空元素
			this.reset();
			//加载imagesdom
			imgDoms = images.getImages(level*level, grad);
			//构造html添加到画布元素
			this.createHtml(imgDoms, level);
			//更新分数面板
			score.reset(level);
			
			//更新时钟
			timer.init((new Date()).getTime() + (level*level)*1000 + level*20*1000);
			//更新储物箱
			store.reset();
		},
		
		/**
		 * 构造html
		 * @method createHtml
		 * @param {Array} imgDoms 图象dom数组元素
		 * @param {Number} level 级别 
		 */
		createHtml:function(imgDoms, level){
			var 
				_$ = $,
				$tbody = $(&#x27;#canvas table tbody&#x27;),
				len = imgDoms.length,
				i = 0,
				j = 0,
				$tr = [],
				$td = [];
				
			for(i; i&lt;level; i++){
				$tr[i] = _$(&#x27;&lt;tr&gt;&lt;/tr&gt;&#x27;);
				for(j=0; j&lt;level; j++){
					$td[i*level + j] = _$(&#x27;&lt;td&gt;&lt;/td&gt;&#x27;);
					$td[i*level + j].append(imgDoms[i*level + j]);
					$tr[i].append($td[i*level + j]);
				}
				
				$tbody.append($tr[i]);
			}	
		},
		
		/**
		 * 初始化画布元素
		 * @method initCanvas 
		 * @param {Array} imgDoms 
		 */
		initCanvas:function(imgDoms){
			var len = imgDoms.lenght;
		},
		/**
		 * 重置画布
		 * @method reset 
		 */
		reset:function(){
			var 
			score = this.score,
			timer = this.timer,
			store = this.store;
			
			$(&#x27;#canvas table tbody&#x27;).empty();
			score.reset();
			timer.reset();
			store.reset();
		},
		
		/**
		 * 绑定单击事件
		 * @event bindClickEvent 
		 */
		bindClickEvent:function(){
			var 
				$goHome = $(&#x27;#go-home&#x27;),
				$table = $(&#x27;#canvas table&#x27;),
				that = this,
				$preImg = null,
				sound = this.sound,
				score = this.score,
                store = this.store,
				success = function(){},
				failed = function(){},
				first = function(){};
			
			//成功的事件
			success = function($currentImg){
				sound.play(&#x27;./media/spread.wav&#x27;);
				$preImg.attr({src:&#x27;./images/background.gif&#x27;, rel:&#x27;&#x27;});
				$currentImg.attr({src:&#x27;./images/background.gif&#x27;, rel:&#x27;&#x27;});
				//更新当前图象
				$preImg = null;
				store.pull();
				//更新已经消除次数
				score.decreaseRemainNumber();
			};	
			
			//失败的事件
			failed = function($currentImg){
				//翻到不相同图象
				that.unclockRotate180($preImg, function(){});
				that.unclockRotate180($currentImg, function(){});
					
				//更新当前图象
				$preImg = null;
				sound.play(&#x27;./media/Click.wav&#x27;);
				
				//更新失败次数
				score.addErrorCount();
			};	
			
			//初次点击事件
			first = function($currentImg){
				//第一次开始翻
				$preImg = $currentImg;
			};
			
			//绑定图片的点击事件	
			$table.delegate(&#x27;img[rel!=&quot;&quot;]:not(.front)&#x27;, &#x27;click&#x27;, function(e){
				var 
					$this = $(this),
					preSrc = $preImg !==null &amp;&amp; $preImg.attr(&#x27;rel&#x27;),
					currentSrc = $this.attr(&#x27;rel&#x27;);

				//更新点击次数
				score.addClickCount();
				
				that.clockRotate180($(this), function(){
					//翻到相同图象
					if(preSrc === currentSrc){
						//消失
						success($this);
					}else if($preImg !==null){
						failed($this);
					}else{
						first($this);
					}
				});	
				
			});
			
			//绑定回到主菜单时间
			$goHome.click(function(e){
				that.reset();//重置画布
				//旋转出元素
				$(&#x27;#wrap&#x27;).rotate3Di(-90, 500, {complete:function(){
					$(this).hide(0, function(){
						$(&#x27;#home&#x27;).show(0, function(){
							$(this).rotate3Di(90);
							$(&#x27;#home&#x27;).rotate3Di(0, 1000, {complete:function(){}});
						});
					});
				}});
			});
		},
		
		/**
		 * 顺时针旋转180度元素 
		 * @method clockRotate180
		 * @param {$object} $obj 旋转的元素
		 * @param {function} callback 回调函数
		 */
		clockRotate180:function($obj, callback){
			$obj.rotate3Di(90, 150, {complete:function(){
				var $this = $(this);
				$this.addClass(&#x27;front&#x27;).attr(&#x27;src&#x27;, $this.attr(&#x27;rel&#x27;)).rotate3Di(-90);
				$this.rotate3Di(0, 150, {complete:function(){callback();}});
			}});
		},
		
		/**
		 * 逆时针时针旋转180度元素 
		 * @method unclockRotate180
		 * @param {$object} $obj 旋转的元素
		 * @param {function} callback 回调函数
		 */
		unclockRotate180:function($obj, callback){
			$obj.delay(200).rotate3Di(-90, 150, {complete:function(){
				var $this = $(this);
				$this.removeClass(&#x27;front&#x27;).attr(&#x27;src&#x27;, &#x27;./images/Shamrock.bmp&#x27;).rotate3Di(90);
				$this.rotate3Di(0, 150, {complete:function(){callback();}});
			}});
		}
	};
		
	
	/**
	* 时间类
	* @class Timer
	* @constructor
	* @extends fan1xia.model.Timer.prototype
	*/
	Timer = function(){};
	
	/**
	* Timer构造函数的原型对象
	* @class Timer.prototype
	* @static
	*/
	Timer.prototype = {
		/**
		 * 初始化
		 * @method init 
		 */
		init:function(timestamp){
			var that = this,
			failed = new window.fan1xia.Failed();
			function callback(){
				that.reset();
				failed.fail();
			}
			//先初始化
			this.setTimer(timestamp, callback);
		},
		
		/**
		 * 复原计时器为零
		 * @method reset 
		 */
		reset:function(){
			$(&#x27;#time&#x27;).countdown({reset:true});
		},
		
		/**
		 * 
		 * @method setTimer
		 * @param {Number} stamp 时间戳
		 * @param {Function} callback 回调函数
		 */
		setTimer:function(stamp, callback){
			$(&#x27;#time&#x27;).countdown({
				timestamp:stamp,
				callback:callback
			});
		}
	};
		
	
	/**
	* 存贮罐类
	* @class Store
	* @constructor
	* @extends fan1xia.model.Store.prototype
	*/
	Store = function(){};
	
	/**
	* Store构造函数的原型对象
	* @class Store.prototype
	* @static
	*/
	Store.prototype = {
		/**
		 * 重置
		 * @method reset 
		 * @param {String} src 路径
		 */
		reset:function(src){
			src = src || &#x27;./images/store.png&#x27;;
			this.src(src);
		},
		
		/**
		 * 放入东西
		 * @method pull
		 * @param {String} src 路径  
		 */
		pull:function(src){
			src = src || &#x27;./images/store-pull.png&#x27;;
			this.src(src);
		},
		
		/**
		 * 更改路径
		 * @method src 
		 * @param {String} src 路径
		 */
		src:function(src){
			$(&#x27;#result img&#x27;).attr(&#x27;src&#x27;, src);
		}
	};
	
	/**
	* 存贮罐类
	* @class Score
	* @constructor
	* @extends fan1xia.model.Score.prototype
	*/
	Score = function(){
	    /**
         * 总对数
         * @property totalPairs
         * @type Number
         * @default 0
         */
		this.totalPairs = 0;
		
		/**
         * 点击次数
         * @property clickCount
         * @type Number
         * @default 0
         */
		this.clickCount = 0;
		
		/**
         * 错误次数
         * @property errorCount
         * @type Number
         * @default 0
         */
		this.errorCount = 0;
	};
	
	/**
	* Score构造函数的原型对象
	* @class Score.prototype
	* @static
	*/
	Score.prototype = {
		/**
		 * 重置
		 * @method reset
		 * @param {Number|undefined} level 级别
		 */
		reset:function(level){
			//设置总队数
			this.setTotalNumber(level*level/2);
			//设置剩余队数
			this.setRemainNumber(level*level/2);
			//设置点击次数
			this.setClickCount();
			//设置错误次数
			this.setErrorCount();
			this.setLevel(window.fan1xia.currentLevel+1);
		},
		
		/**
		 * 设置难度
		 * @method setLevel
		 * @param {Number} level 要设置的难度
		 * @return {Number} 设置的难度
		 */
		setLevel:function(level){
		   var
                $tds = $(&#x27;#score-panel td&#x27;);
            $tds.eq(9).html(level);
            
            return level;  
		},
		
		/**
		 * 设置总队数
		 * @method setTotalNumber 
		 * @param {Number} total 总队数
		 * @return {Number} 总对数
		 */
		setTotalNumber:function(total){
			var
				$tds = $(&#x27;#score-panel td&#x27;);
			$tds.eq(1).html(total + &#x27;对&#x27;);
			this.totalPairs = total;
			
			return this.totalPairs;
		},
		
		/**
         * 过去总对数
         * @method getTotalNumber 
         * @return {Number} 总队数
         */
		getTotalNumber:function(){
		    return this.totalPairs;
		},
		
		/**
		 * 设置还剩对少对
		 * @method setRemainNumber
		 * @param {Number|undefined} remain 剩余队数
		 */
		setRemainNumber:function(remain){
			var
				$tds = $(&#x27;#score-panel td&#x27;);
			$tds.eq(3).html(remain + &#x27;对&#x27;);
		},
		/**
		 * 获取剩余对数
		 * @method getRemainNumber
		 * @return {Number} count 当前还剩余队数 
		 */
		getRemainNumber:function(){
			var
				$tds = $(&#x27;#score-panel td&#x27;);
			return parseInt($tds.eq(3).html(), 10);
		},
		/**
		 * 剩余队数自减 
		 * @method decreaseRemainNumber
		 * 
		 */
		decreaseRemainNumber:function(){
			var count = this.getRemainNumber(),
				success = {},
				canvas = window.fan1xia.canvas;
			
			this.setRemainNumber(count - 1);
			if(this.checkSuccess(count - 1)){
				//返回胜利界面
				success = new window.fan1xia.Success();
				success.success();
				canvas.reset();//重置画布
			}
		},
		/**
		 * 检查是否结束
		 * @method checkSuccess 
		 * @param {Number} count 数量
		 * @param {Bollean} success 是否成功
		 */
		checkSuccess:function(count){
			return count === 0 ? true : false; 
		},
		/**
		 * 设置还剩对少对
		 * @method setClickCount
		 * @param {Number|undefined} count 剩余队数
		 */
		setClickCount:function(count){
			count = count || 0;
			var
				$tds = $(&#x27;#score-panel td&#x27;);
			$tds.eq(5).html(count + &#x27;次&#x27;);
		    this.clickCount = count;
		    return count;
		},
		/**
		 * 获取点击次数
		 * @method getClickCount
		 * @return {Number} count 点击次数 
		 */
		getClickCount:function(){			
			return this.clickCount;
		},
		/**
		 *  增加点击次数
		 * @method addClickCount
		 */
		addClickCount:function(){
			this.setClickCount(this.getClickCount() + 1);
		},
		/**
		 * 设置失败次数
		 * @method setErrorCount
		 * @param {Number|undefined} count 剩余队数
		 */
		setErrorCount:function(count){
			count = count || 0;
			var
				$tds = $(&#x27;#score-panel td&#x27;);
			$tds.eq(7).html(count + &#x27;次&#x27;);
			this.errorCount = count;
			return count;
		},
		/**
		 * 获取错误次数
		 * @method getErrorCount
		 * @return {Number} count 错误次数 
		 */
		getErrorCount:function(){
			return this.errorCount;
		},
		
		/**
		 * 添加错误数
		 * @method addErrorCount
		 */
		addErrorCount:function(){
			this.setErrorCount(this.getErrorCount() + 1);
		}
	};
	
	
	window.fan1xia = window.fan1xia || {};
	window.fan1xia.model = window.fan1xia.model || {};
    window.fan1xia.model.Canvas = Canvas;
    window.fan1xia.model.Timer = Timer;
	window.fan1xia.model.Store = Store;
	window.fan1xia.model.Score = Score;
}(jQuery, window));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
